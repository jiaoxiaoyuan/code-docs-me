---
typora-root-url: assets
---

# 第十一章 数据埋点

# 一.数据埋点介绍

> 在实际业务问题中,难免会遇到这样的问题 , 分析时缺少关键的数据指标 ,或数据指标的维度和属性满足不了分析需求 , 这个时候就需要通过数据埋点获取我们想要的数据内容

- **埋点**是数据采集的专用术语,在数据驱动型业务中 , 如营销策略 ,产品迭代, 业务分析 , 用户画像等 , 都依赖于数据提供决策支持 , 希望通过数据来捕捉特定的用户行为 , 如按钮点击量 , 阅读时常等统计信息.因此,
- **数据埋点**:针对特定业务场景进行数据采集和上报的技术方案

# 二.埋点形式介绍

## 1.代码埋点

- 需要在网页上加一些代码,检测用户行为,当用户触发相应行为时,进行数据上报,也就是代码埋点
- 优点:可以详细的设置某一个事件自定义属性
- 缺点:时间, 人力成本大 , 数据传输的时效性

## 2.可视化埋点

- 利用可视化交互手段,数据产品/数据分析师可以通过可视化界面(管理后台连接设备)配置事件 , 可视化埋点仍需要先配置相关事件,再采集
- 优点:埋点只需要业务人员接入,无需开发人员支持;
- 缺点:仅支持客户端行为(APP)

## 3.无埋点(全埋点)

> 神策  友盟 腾讯移动分析 Talkingdata GrowingIO

- 指开发人员集成采集SDK后,SDK便直接开始捕捉和监测用户在应用里的所有行为,并全部上报,**不需要开发人员添加额外代码**.数据分析师/数据产品经理通过管理后台的圈选功能来选出自己关注的用户行为,并给出事件命名.之后结合时间属性,用户属性,事件进行分析,所以无埋点并不是真的不埋点了
- 优点:无需开发,业务人员埋点即可;支持先上报数据,后进行埋点
- 缺点:数据存储量大

# 三.代码埋点方案

## 1.采集方式

前提:**用户唯一标识**:**设备ID+用户ID**

- Web端数据采集实现方式:
  - 服务器日志 : 时间 , IP地址信息等
  - URL解析: 知道用户搜索了什么
  - JS回传: 在Web页面上添加各类统计插件, 获取点击行为,点击内容 , 通过Ajax请求传到后台记录日志

## 2. 埋点流程规范

### ①规划评审(参与)

- 反馈需求,设计字段
- 多个部门一起参与评审

#### 4W1H模型

- who : 设备ID, 用户ID,手机号,微信识别码等
  - 
- when :什么时间，记录日志的时间戳　，日志上报的时间戳
- where:IP地址,GPS地址在哪里
  - adr套接字有返回客户端的地址信息
- How:(以什么方式)操作系统,设备型号,网络环境,APP版本 ,当前页面等信息
  - 请求报文中获取
- What:(做了什么事情)
  - 如果是搜索行为,则记录关联词;
  - 如果是内容点击,记录内容ID,内容类型,列表位置;
  - 若为支付过程,记录付款的方式与付款金额

### ②技术开发

### ③埋点验证

- 实时功能验证:在灰度环境上测试相应的埋点功能是否正常
  - 记录正常
  - 位置正确:查看SPM和SCM码与平台申请的是否相同
  - 内容正确
- 离线的日志验证：

![1647956307368](/1647956307368.png)

### ④发布上线

### ⑤检测评估(参与)

- 发现问题
- 提出优化方案
- 迭代更新

# 四.埋点实践

## 1.数据分析人员-两大问题

- 埋点数据:
  - 要什么数据?
  - 有什么字段属性?
- 埋点位置
  - 前端埋点?
  - 后端埋点?

> 分析人员编写一份**数据需求文档****(**DRD**)**
>
> Data Requirements Document 

## 2.埋点数据

>   以短视频为例

### 获取字段属性(根据需求)

一级指标数据

- 点赞量
- 评论量
- 转发量
- 观看时常

还可以衍生出子需求:(二级指标数据)

- 哪些地区的用户喜欢看我的视频?
- 那些年龄段的喜欢看?

![1647956985916](/1647956985916.png)

> 怎么保证数据有效性?
>
> 用指标:
>
> - 比如点赞率(点赞人数/实际观看人数)
> - 转发率(转发量/实际观看人数)

### **数据分析的本质**:

- 通过观察一组或多组关联数据连续变化的情况,分析出数据变化的原因和可能性

### 字段选取方法

- 评经验选择埋点数据
  - 要求:要有相当的行业经验,很快根据需求选定一组关联字段
  - 在新需求出现时,频繁添加埋点字段的属性,需要不断的和开发人员沟通
- 小白:4W1H(通用:公共属性)
  - 什么人
  - 什么时间
  - 在哪里
  - 以什么方式
  - 干了什么事

## 3.埋点位置

**数据只能从前端获取的从前端获取,其他数据建议全部后端埋点**(90%)

- 例如 : 只能在前端获取的数据:停留时间 , 视频观看时长和观看次数

### 前端埋点的缺陷

- 数据实时性
  - APP若频繁发送请求给后端,会导致手机资源严重损耗
  - 因此为了提高用户体验,APP会搜集一段时间的数据,同一发送给后端,这样就造成了数据不是实时的
- 无法确认what完成情况
  - 用户点击了, 无法确认事件是否真正发生
    - 例如验证码,前端无法知道,只有后端能知道短信是否发送成功
- 代码的改动依赖版本的更新
  - 在APP添加了埋点代码后.如果用户不更新APP,则无法采集到数据
  - 用户的APP应用上架更新需要审核
  - 后端只需要将公司的服务端重启一下就可以实现服务更新

## 4.埋点文档编写

> 以爱阅读为例

![ 1647960443519](/1647960443519.png)

![1647960485607](/1647960485607.png)

![1647960547573](/1647960547573.png)

![1647960614339](/1647960614339.png)

 ![1647960955961](/1647960955961.png)

## 5.代码

- 一般使用日志写埋点
- 开发人员开发

## 6.数仓(ETL)

- 在日志中的数据可以通过搭建ETL进行抽取 ,转换 , 加载.
  - 通过大数据的一些工具将日志数据写入数仓
- 数据分析人员可以从ETL中获取数据进行相关的数据分析工作......(后续会继续学习)